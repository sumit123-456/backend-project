{% extends 'app/base3.html' %}
{% block content %}

<!-- CONTENT --><main class="content-wrap"><div class="d-flex justify-content-between mb-3" style="background:#fff;border:1px solid #e5e7eb;padding:10px 15px;border-radius:4px;"><div class="page-title">My Profile</div><a href="{% url 'tl-dashboard' %}"><div class="text-muted">Dashboard</div></a></div><!-- PROFILE OVERVIEW --><div style="background:#ffffff; border-radius:10px; box-shadow:0px 2px 6px rgba(0,0,0,0.08); 
            border:1px solid #e5e7eb; overflow:hidden; margin:20px 0;"><!-- Profile Header --><div style="padding:30px; border-bottom:1px solid #e5e7eb;background: linear-gradient(135deg, #0b7368 0%, #0a6d65 100%); color:white;"><div style="display:flex; align-items:center; gap:25px; flex-wrap: wrap;"><!-- Profile Picture --><div style="position:relative;"><div style="width:120px; height:120px; border-radius:50%; background:#f8f9fa; 
                           display:flex; align-items:center; justify-content:center; 
                           border:4px solid white; box-shadow:0 4px 12px rgba(0,0,0,0.2); overflow: hidden;">
                    {% if employee.image %}
                        <img src="{{ employee.image.url }}" alt="Profile" style="width: 100%; height: 100%; object-fit: cover;">
                    {% else %}
                        <i class="fas fa-user" style="font-size:48px; color:#0b7368;"></i>
                    {% endif %}
                </div><button onclick="changeProfilePicture()" 
                        style="position:absolute; bottom:0; right:0; width:35px; height:35px; 
                               background:#28a745; border:2px solid white; border-radius:50%; 
                               color:white; cursor:pointer; display:flex; align-items:center; justify-content:center;"><i class="fas fa-camera" style="font-size:12px;"></i></button></div><!-- Profile Info --><div style="flex:1; min-width: 250px;"><h3 style="margin:0; font-weight:700; font-size:28px;" id="tlName">{{ employee.first_name }} {{ employee.last_name }}</h3><p style="margin:5px 0; font-size:16px; opacity:0.9;" id="tlDesignation">{{ employee.designation }}</p><p style="margin:5px 0; font-size:14px; opacity:0.8;" id="tlDepartment">{{ employee.department }}</p><div style="display:flex; gap:15px; margin-top:15px; flex-wrap: wrap;"><div style="background:rgba(255,255,255,0.2); padding:8px 12px; border-radius:20px; font-size:12px;"><i class="fas fa-users me-1"></i><span>Team:</span> {{ team_count }} Members
                    </div><div style="background:rgba(255,255,255,0.2); padding:8px 12px; border-radius:20px; font-size:12px;"><i class="fas fa-id-card me-1"></i><span>ID:</span> {{ employee.company_id }}
                    </div><div style="background:rgba(255,255,255,0.2); padding:8px 12px; border-radius:20px; font-size:12px;"><i class="fas fa-envelope me-1"></i><span>Email:</span> {{ employee.email }}
                    </div><div style="background:rgba(255,255,255,0.2); padding:8px 12px; border-radius:20px; font-size:12px;"><i class="fas fa-star me-1"></i><span>Experience:</span> {{ tl.experience_years }} Years
                    </div></div></div><!-- Edit Profile Button --><div><button onclick="editProfile()" 
                        style="background:white; color:#0b7368; border:none;
                               padding:12px 20px; border-radius:8px; font-weight:600; 
                               font-size:14px; box-shadow:0 2px 8px rgba(0,0,0,0.2);"><i class="fas fa-edit me-2"></i><span>Edit Profile</span></button></div></div></div><!-- Profile Tabs --><div style="padding:0;"><ul class="nav nav-tabs" style="border-bottom:1px solid #e5e7eb; background:#f8f9fa;"><li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#personalInfo" 
                   style="border:none; color:#333; font-weight:600; padding:15px 20px;"><i class="fas fa-user me-2"></i><span>Personal Information</span></a></li><li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#workInfo" 
                   style="border:none; color:#333; font-weight:600; padding:15px 20px;"><i class="fas fa-briefcase me-2"></i><span>Work Information</span></a></li><li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#teamInfo" 
                   style="border:none; color:#333; font-weight:600; padding:15px 20px;"><i class="fas fa-users me-2"></i><span>Team Information</span></a></li><li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#settings" 
                   style="border:none; color:#333; font-weight:600; padding:15px 20px;"><i class="fas fa-cog me-2"></i><span>Settings</span></a></li></ul><!-- Tab Content --><div class="tab-content" style="padding:30px;"><!-- Personal Information Tab --><div class="tab-pane fade show active" id="personalInfo"><div class="row g-4"><div class="col-md-6"><label class="form-label fw-bold">First Name</label><input type="text" class="form-control" value="{{ employee.first_name }}" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div><div class="col-md-6"><label class="form-label fw-bold">Last Name</label><input type="text" class="form-control" value="{{ employee.last_name }}" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div><div class="col-md-6"><label class="form-label fw-bold">Email Address</label><input type="email" class="form-control" value="{{ employee.email }}" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div><div class="col-md-6"><label class="form-label fw-bold">Contact Number</label><input type="tel" class="form-control" value="{{ employee.contact_number|default:'N/A' }}" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div><div class="col-md-6"><label class="form-label fw-bold">Employee ID</label><input type="text" class="form-control" value="{{ employee.company_id }}" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div><div class="col-md-6"><label class="form-label fw-bold">Official Email</label><input type="email" class="form-control" value="{{ employee.official_email|default:'N/A' }}" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div><div class="col-12"><label class="form-label fw-bold">Address</label><textarea class="form-control" rows="3" readonly 
                                  style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;">{{ employee.address|default:'N/A' }}</textarea></div><div class="col-md-6"><label class="form-label fw-bold">Family Contact</label><input type="text" class="form-control" value="{{ employee.family_contact_number|default:'N/A' }}" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div><div class="col-md-6"><label class="form-label fw-bold">Family Relation</label><input type="text" class="form-control" value="{{ employee.family_relation|default:'N/A' }}" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div></div></div><!-- Work Information Tab --><div class="tab-pane fade" id="workInfo"><div class="row g-4"><div class="col-md-6"><label class="form-label fw-bold">Designation</label><input type="text" class="form-control" value="{{ employee.designation }}" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div><div class="col-md-6"><label class="form-label fw-bold">Department</label><input type="text" class="form-control" value="{{ employee.department }}" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div><div class="col-md-6"><label class="form-label fw-bold">Package</label><input type="text" class="form-control" value="₹{{ employee.package }}" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div><div class="col-md-6"><label class="form-label fw-bold">Contract Years</label><input type="text" class="form-control" value="{{ employee.contract_years }} Years" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div><div class="col-md-6"><label class="form-label fw-bold">Contract Start</label><input type="text" class="form-control" value="{{ employee.contract_start_date|default:'N/A' }}" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div><div class="col-md-6"><label class="form-label fw-bold">Contract End</label><input type="text" class="form-control" value="{{ employee.contract_end_date|default:'N/A' }}" readonly 
                               style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;" /></div><div class="col-12"><label class="form-label fw-bold">Certifications</label><textarea class="form-control" rows="3" readonly 
                                  style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;">{{ employee.certifications|default:'N/A' }}</textarea></div></div></div><!-- Team Information Tab --><div class="tab-pane fade" id="teamInfo"><div class="row g-4"><div class="col-md-6"><div style="border:1px solid #e5e7eb; border-radius:8px; padding:20px; text-align:center; background:#f8f9fa;"><h3 style="color:#0b7368; margin:0; font-size:36px; font-weight:700;">{{ team_count }}</h3><p style="margin:5px 0; color:#666; font-weight:600;">Team Members</p><small style="color:#999;">Under Management</small></div></div><div class="col-md-6"><div style="border:1px solid #e5e7eb; border-radius:8px; padding:20px; text-align:center; background:#f8f9fa;"><h3 style="color:#0b7368; margin:0; font-size:36px; font-weight:700;">{{ tl.experience_years }}</h3><p style="margin:5px 0; color:#666; font-weight:600;">Years of Experience</p><small style="color:#999;">As Team Leader</small></div></div><div class="col-12"><label class="form-label fw-bold">Key Responsibilities</label><textarea class="form-control" rows="4" readonly 
                                  style="background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:12px;">{{ tl.responsibilities|default:'N/A' }}</textarea></div><div class="col-12"><h6 class="fw-bold mb-3" style="color:#333;">Team Members List</h6>
                        {% if team_members %}
                            <div class="row g-3">
                                {% for member in team_members %}
                                <div class="col-md-6 col-lg-4"><div style="border:1px solid #e5e7eb; border-radius:8px; padding:15px; background:#f8f9fa;"><div style="font-weight:600; margin-bottom:5px;">{{ member.employee.first_name }} {{ member.employee.last_name }}</div><div style="color:#666; font-size:14px; margin-bottom:5px;">{{ member.employee.designation }}</div><div style="color:#999; font-size:12px;">Role: {{ member.role }}</div><div style="color:#999; font-size:12px;">Assigned: {{ member.assignment_date }}</div></div></div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div style="text-align:center; padding:40px; color:#666;"><i class="fas fa-users" style="font-size:48px; margin-bottom:15px; color:#ccc;"></i><h5>No Team Members</h5><p>You haven't been assigned any team members yet.</p></div>
                        {% endif %}
                    </div></div></div><!-- Settings Tab --><div class="tab-pane fade" id="settings"><div class="row g-4"><div class="col-12"><h6 class="fw-bold mb-3">Account Settings</h6><!-- Change Password --><div style="border:1px solid #e5e7eb; border-radius:8px; padding:20px; margin-bottom:20px;"><h6 class="fw-bold mb-3" style="color:#333;">Change Password</h6><div class="row g-3"><div class="col-md-4"><label class="form-label">Current Password</label><input type="password" class="form-control" placeholder="••••••••" /></div><div class="col-md-4"><label class="form-label">New Password</label><input type="password" class="form-control" placeholder="••••••••" /></div><div class="col-md-4"><label class="form-label">Confirm Password</label><input type="password" class="form-control" placeholder="••••••••" /></div></div><div class="mt-3"><button class="btn btn-outline-primary"><i class="fas fa-key me-2"></i><span>Update Password</span></button></div></div><!-- Notification Settings --><div style="border:1px solid #e5e7eb; border-radius:8px; padding:20px; margin-bottom:20px;"><h6 class="fw-bold mb-3" style="color:#333;">Notification Settings</h6><div class="row g-3"><div class="col-md-6"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="emailNotifications" checked><label class="form-check-label" for="emailNotifications">Email Notifications</label></div><small class="text-muted">Receive notifications via email</small></div><div class="col-md-6"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="teamNotifications" checked><label class="form-check-label" for="teamNotifications">Team Notifications</label></div><small class="text-muted">Get notifications about team activities</small></div><div class="col-md-6"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="leaveNotifications" checked><label class="form-check-label" for="leaveNotifications">Leave Notifications</label></div><small class="text-muted">Get notifications for leave requests</small></div><div class="col-md-6"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="projectNotifications" checked><label class="form-check-label" for="projectNotifications">Project Notifications</label></div><small class="text-muted">Receive project updates and assignments</small></div></div></div><!-- Privacy Settings --><div style="border:1px solid #e5e7eb; border-radius:8px; padding:20px; margin-bottom:20px;"><h6 class="fw-bold mb-3" style="color:#333;">Privacy Settings</h6><div class="row g-3"><div class="col-md-6"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="profileVisibility" checked><label class="form-check-label" for="profileVisibility">Profile Visibility</label></div><small class="text-muted">Allow team members to view your profile</small></div><div class="col-md-6"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="activityStatus"><label class="form-check-label" for="activityStatus">Show Activity Status</label></div><small class="text-muted">Show when you're online</small></div></div></div><!-- Save Settings Button --><div class="text-end"><button class="btn btn-success"><i class="fas fa-save me-2"></i><span>Save Settings</span></button></div></div></div></div></div></div></div></main><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script><script>

// Change profile picture
function changeProfilePicture() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.onchange = function(event) {
        const file = event.target.files[0];
        if (file) {
            // In real implementation, this would upload the file and update the profile picture
            alert('Profile picture updated successfully!');
        }
    };
    input.click();
}

// Edit profile
function editProfile() {
    // Remove readonly attribute from all inputs to enable editing
    const readonlyInputs = document.querySelectorAll('input[readonly], textarea[readonly], select[readonly]');
    readonlyInputs.forEach(input => {
        input.removeAttribute('readonly');
        input.style.backgroundColor = '#fff';
    });

    // Change edit button to save button
    const editButton = document.querySelector('button[onclick="editProfile()"]');
    editButton.innerHTML = '<i class="fas fa-save me-2"></i><span>Save Profile</span>';
    editButton.onclick = saveProfile;
}

// Save profile
function saveProfile() {
    if (confirm('Are you sure you want to save the changes?')) {
        // Add readonly attribute back to all inputs
        const editableInputs = document.querySelectorAll('input:not([readonly]), textarea:not([readonly]), select:not([readonly])');
        editableInputs.forEach(input => {
            input.setAttribute('readonly', 'readonly');
            input.style.backgroundColor = '#f8f9fa';
        });

        // Change save button back to edit button
        const saveButton = document.querySelector('button[onclick="saveProfile()"]');
        saveButton.innerHTML = '<i class="fas fa-edit me-2"></i><span>Edit Profile</span>';
        saveButton.onclick = editProfile;

        alert('Profile updated successfully!');
    }
}

// Initialize tooltips and other Bootstrap components
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Bootstrap components if needed
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>

{% endblock %}