{% extends 'app/base3.html'%}
{% block content %}
<!-- CONTENT --><main class="content-wrap"><div class="d-flex justify-content-between mb-3" style="background:#fff;border:1px solid #e5e7eb;padding:10px 15px;border-radius:4px;"><div class="page-title">Team Leave Approval Management</div><a href="/tl/dashboard.html"><div class="text-muted">Dashboard</div></a></div><!-- TEAM LEAVE APPROVAL STATISTICS --><div style="display:flex; gap:20px; flex-wrap:wrap; margin:20px 0; font-family:Poppins, sans-serif;"><!-- CARD 1 --><div style="flex:1; min-width:220px; background:#ffffff; border-radius:10px;
                border-top:6px solid #0a6d65; padding:25px; text-align:center;
                box-shadow:0px 2px 6px rgba(0,0,0,0.08);"><div style="font-size:38px; color:#1a73e8; margin-bottom:8px;"><i class="fa-solid fa-clock"></i></div><div style="font-size:32px; font-weight:700; color:#000;">{{ total_pending }}</div><div style="font-size:15px; color:#666; margin-top:4px;">Pending Approvals</div></div><!-- CARD 2 --><div style="flex:1; min-width:220px; background:#ffffff; border-radius:10px;
                border-top:6px solid #0a6d65; padding:25px; text-align:center;
                box-shadow:0px 2px 6px rgba(0,0,0,0.08);"><div style="font-size:38px; color:#28a745; margin-bottom:8px;"><i class="fa-solid fa-check-circle"></i></div><div style="font-size:32px; font-weight:700; color:#000;">{{ approved_this_month }}</div><div style="font-size:15px; color:#666; margin-top:4px;">Approved This Month</div></div><!-- CARD 3 --><div style="flex:1; min-width:220px; background:#ffffff; border-radius:10px;
                border-top:6px solid #0a6d65; padding:25px; text-align:center;
                box-shadow:0px 2px 6px rgba(0,0,0,0.08);"><div style="font-size:38px; color:#dc3545; margin-bottom:8px;"><i class="fa-solid fa-times-circle"></i></div><div style="font-size:32px; font-weight:700; color:#000;">{{ rejected_this_month }}</div><div style="font-size:15px; color:#666; margin-top:4px;">Rejected This Month</div></div><!-- CARD 4 --><div style="flex:1; min-width:220px; background:#ffffff; border-radius:10px;
                border-top:6px solid #0a6d65; padding:25px; text-align:center;
                box-shadow:0px 2px 6px rgba(0,0,0,0.08);"><div style="font-size:38px; color:#6f42c1; margin-bottom:8px;"><i class="fa-solid fa-calendar-days"></i></div><div style="font-size:32px; font-weight:700; color:#000;">{{ total_leave_days }}</div><div style="font-size:15px; color:#666; margin-top:4px;">Total Leave Days</div></div></div><!-- TEAM LEAVE FILTERS --><div style="border:2px solid #0b7368; border-radius:10px; padding:20px;
            font-family:Poppins, sans-serif; margin:20px 0;"><div style="display:flex; flex-wrap:wrap; align-items:center; gap:25px;"><!-- Status Filter --><div style="display:flex; flex-direction:column;"><label style="font-weight:600; color:#333; font-size:14px;">Status</label><select style="padding:10px 15px; width:220px; border:1px solid #ddd;
                           border-radius:6px; outline:none; font-size:14px;" id="statusFilter"><option value="all">All Status</option><option value="pending">Pending</option><option value="approved">Approved</option><option value="rejected">Rejected</option></select></div><!-- Leave Type Filter --><div style="display:flex; flex-direction:column;"><label style="font-weight:600; color:#333; font-size:14px;">Leave Type</label><select style="padding:10px 15px; width:220px; border:1px solid #ddd;
                           border-radius:6px; outline:none; font-size:14px;" id="leaveTypeFilter"><option value="all">All Types</option><option value="annual">Annual Leave</option><option value="sick">Sick Leave</option><option value="emergency">Emergency Leave</option><option value="personal">Personal Leave</option><option value="vacation">Vacation Leave</option></select></div><!-- Team Member Filter --><div style="display:flex; flex-direction:column;"><label style="font-weight:600; color:#333; font-size:14px;">Team Member</label><select style="padding:10px 15px; width:220px; border:1px solid #ddd;
                           border-radius:6px; outline:none; font-size:14px;" id="teamMemberFilter"><option value="all">All Team Members</option><option value="alice">Alice Johnson</option><option value="bob">Bob Smith</option><option value="carol">Carol Davis</option><option value="david">David Wilson</option><option value="emma">Emma Brown</option><option value="frank">Frank Miller</option><option value="grace">Grace Lee</option><option value="henry">Henry Taylor</option></select></div><!-- Date Range --><div style="display:flex; flex-direction:column;"><label style="font-weight:600; color:#333; font-size:14px;">Date Range</label><input type="date" id="dateFilter"
                   style="padding:10px 15px; width:220px; border:1px solid #ddd;
                          border-radius:6px; outline:none; font-size:14px;" /></div><!-- SEARCH BOX WITH ICON INSIDE --><div style="display:flex; flex-direction:column; position:relative;"><label style="font-weight:600; color:#333; font-size:14px;">Search</label><input type="text" placeholder="Search team member or reason..." id="searchInput"
                   style="padding:10px 45px 10px 15px; width:220px; border:1px solid #ddd;
                          border-radius:6px; outline:none; font-size:14px;" /><!-- Icon inside box (Right side) --><i class="fa-solid fa-magnifying-glass"
               style="position:absolute; right:12px; top:38px; color:#777;
                      font-size:14px;"></i></div><!-- Buttons --><div style="margin-left:auto; display:flex; gap:12px;"><!-- Export Button --><button onclick="exportTeamLeaveData()" style="background:#34a853; color:#fff; border:none;
                           padding:10px 22px; border-radius:6px; font-size:18px;"><i class="fa-solid fa-download"></i></button></div></div></div><!-- TEAM LEAVE REQUESTS TABLE --><div style="background:teal;color: white; border-radius:10px; box-shadow:0px 2px 6px rgba(0,0,0,0.08); 
            border:1px solid #e5e7eb; overflow:hidden; margin-top:20px;"><!-- Table Header --><div style="padding:20px; border-bottom:1px solid #e5e7eb;"><div class="d-flex justify-content-between align-items-center"><h5 style="margin:0; font-weight:600; color:#fdfbfb;">Team Leave Requests</h5><div class="btn-group" role="group"><button type="button" class="btn btn-secondary btn-sm active" id="allViewBtn"><i class="fas fa-list"></i> All
                </button><button type="button" class="btn btn-warning btn-sm" id="pendingViewBtn"><i class="fas fa-clock"></i> Pending
                </button><button type="button" class="btn btn-success btn-sm" id="approvedViewBtn"><i class="fas fa-check"></i> Approved
                </button><button type="button" class="btn btn-danger btn-sm" id="rejectedViewBtn"><i class="fas fa-times"></i> Rejected
                </button></div></div></div><!-- Messages -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert" style="margin: 20px;">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>
        {% endfor %}
    {% endif %}

    <!-- Responsive Table --><div class="table-responsive"><table class="table table-hover mb-0" style="font-family:Poppins, sans-serif;"><thead style="background:#f8f9fa;"><tr><th class="px-4 py-3" style="font-weight:600; color:#333; font-size:14px;">Team Member</th><th class="px-4 py-3" style="font-weight:600; color:#333; font-size:14px;">Role</th><th class="px-4 py-3" style="font-weight:600; color:#333; font-size:14px;">Leave Type</th><th class="px-4 py-3" style="font-weight:600; color:#333; font-size:14px;">Start Date</th><th class="px-4 py-3" style="font-weight:600; color:#333; font-size:14px;">End Date</th><th class="px-4 py-3" style="font-weight:600; color:#333; font-size:14px;">Days</th><th class="px-4 py-3" style="font-weight:600; color:#333; font-size:14px;">Reason</th><th class="px-4 py-3" style="font-weight:600; color:#333; font-size:14px;">Applied On</th><th class="px-4 py-3" style="font-weight:600; color:#333; font-size:14px;">Status</th><th class="px-4 py-3" style="font-weight:600; color:#333; font-size:14px;">Actions</th></tr></thead><tbody>
                {% for leave in pending_leaves %}
                <tr><td class="px-4 py-3"><div><div style="font-weight:600;">{{ leave.employee.first_name }} {{ leave.employee.last_name }}</div><div style="font-size:12px; color:#666;">{{ leave.employee.company_id }} â€¢ {{ leave.employee.department }}</div></div></td><td class="px-4 py-3">{{ leave.employee.designation }}</td><td class="px-4 py-3"><span class="badge bg-primary">{{ leave.get_leave_type_display }}</span></td><td class="px-4 py-3" style="font-size:14px; color:#333;">{{ leave.start_date|date:"M d, Y" }}</td><td class="px-4 py-3" style="font-size:14px; color:#333;">{{ leave.end_date|date:"M d, Y" }}</td><td class="px-4 py-3" style="font-size:14px; color:#333; font-weight:600;">{{ leave.total_days }}</td><td class="px-4 py-3" style="font-size:14px; color:#333;"><div style="max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;" title="{{ leave.reason }}">
                            {{ leave.reason|truncatechars:50 }}
                        </div></td><td class="px-4 py-3" style="font-size:14px; color:#333;">{{ leave.applied_at|date:"M d, Y" }}</td><td class="px-4 py-3"><span class="badge bg-warning text-dark">{{ leave.status|title }}</span></td><td class="px-4 py-3"><button class="btn btn-sm btn-outline-primary me-1" data-bs-toggle="modal" data-bs-target="#leaveDetailsModal{{ leave.id }}"><i class="fas fa-eye"></i></button><form method="POST" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="approve"><input type="hidden" name="leave_id" value="{{ leave.id }}"><button type="submit" class="btn btn-sm btn-outline-success me-1" onclick="return confirm('Are you sure you want to approve this leave request?')"><i class="fas fa-check"></i></button></form><button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#rejectModal{{ leave.id }}"><i class="fas fa-times"></i></button></td></tr><!-- Leave Details Modal --><div class="modal fade" id="leaveDetailsModal{{ leave.id }}" tabindex="-1" aria-labelledby="leaveDetailsModalLabel{{ leave.id }}" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content" style="border:none; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.15);"><div class="modal-header" style="background:linear-gradient(135deg, #0a6d65 0%, #1a7370 100%); color:white; border-radius:15px 15px 0 0; border:none;"><h5 class="modal-title fw-bold" id="leaveDetailsModalLabel{{ leave.id }}"><i class="fas fa-calendar-alt me-2"></i>Leave Request Details
                                </h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body p-4"><div class="row"><div class="col-md-6"><h6 class="fw-bold">Team Member Information</h6><p><strong>Name:</strong> {{ leave.employee.first_name }} {{ leave.employee.last_name }}</p><p><strong>Employee ID:</strong> {{ leave.employee.company_id }}</p><p><strong>Department:</strong> {{ leave.employee.department }}</p><p><strong>Designation:</strong> {{ leave.employee.designation }}</p><p><strong>Applied On:</strong> {{ leave.applied_at|date:"F d, Y" }}</p></div><div class="col-md-6"><h6 class="fw-bold">Leave Details</h6><p><strong>Leave Type:</strong> {{ leave.get_leave_type_display }}</p><p><strong>Start Date:</strong> {{ leave.start_date|date:"F d, Y" }}</p><p><strong>End Date:</strong> {{ leave.end_date|date:"F d, Y" }}</p><p><strong>Total Days:</strong> {{ leave.total_days }}</p><p><strong>Status:</strong><span class="badge bg-warning text-dark">{{ leave.status|title }}</span></p></div></div><div class="row mt-3"><div class="col-12"><h6 class="fw-bold">Reason for Leave</h6><p>{{ leave.reason|linebreaks }}</p></div></div>
                                {% if leave.contact_details %}
                                <div class="row mt-3"><div class="col-12"><h6 class="fw-bold">Contact Information</h6><p>{{ leave.contact_details }}</p></div></div>
                                {% endif %}
                                {% if leave.emergency_contact %}
                                <div class="row mt-3"><div class="col-12"><h6 class="fw-bold">Emergency Contact</h6><p>{{ leave.emergency_contact }}</p></div></div>
                                {% endif %}
                            </div><div class="modal-footer border-0 pt-0"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal" 
                                        style="border-radius:8px; padding:8px 20px; font-weight:500;">
                                    Close
                                </button><form method="POST" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="approve"><input type="hidden" name="leave_id" value="{{ leave.id }}"><button type="submit" class="btn btn-success me-2" 
                                            onclick="return confirm('Are you sure you want to approve this leave request?')"
                                            style="border-radius:8px; padding:8px 20px; font-weight:500;"><i class="fas fa-check me-1"></i>Approve
                                    </button></form><button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#rejectModal{{ leave.id }}"
                                        style="border-radius:8px; padding:8px 20px; font-weight:500;"><i class="fas fa-times me-1"></i>Reject
                                </button></div></div></div></div><!-- Rejection Modal --><div class="modal fade" id="rejectModal{{ leave.id }}" tabindex="-1" aria-labelledby="rejectModalLabel{{ leave.id }}" aria-hidden="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content" style="border:none; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.15);"><div class="modal-header" style="background:linear-gradient(135deg, #dc3545 0%, #c82333 100%); color:white; border-radius:15px 15px 0 0; border:none;"><h5 class="modal-title fw-bold" id="rejectModalLabel{{ leave.id }}"><i class="fas fa-times-circle me-2"></i>Reject Leave Request
                                </h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button></div><form method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="reject"><input type="hidden" name="leave_id" value="{{ leave.id }}"><div class="modal-body p-4"><div class="mb-3"><label for="comments{{ leave.id }}" class="form-label fw-bold">Please provide a reason for rejection:</label><textarea class="form-control" id="comments{{ leave.id }}" name="comments" rows="4" 
                                                  placeholder="Enter rejection reason..." required
                                                  style="border:1px solid #ddd; border-radius:8px; padding:10px; resize:vertical;"></textarea></div></div><div class="modal-footer border-0 pt-0"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal" 
                                            style="border-radius:8px; padding:8px 20px; font-weight:500;">
                                        Cancel
                                    </button><button type="submit" class="btn btn-danger" 
                                            onclick="return confirm('Are you sure you want to reject this leave request?')"
                                            style="border-radius:8px; padding:8px 20px; font-weight:500;"><i class="fas fa-times me-1"></i>Reject Leave
                                    </button></div></form></div></div></div>
                {% empty %}
                <tr><td colspan="10" class="px-4 py-5 text-center"><div style="color:#6c757d;"><i class="fas fa-calendar-times fa-3x mb-3"></i><p class="mb-0">No pending leave requests from your team members.</p><small>Leave requests from your team members will appear here for approval.</small></div></td></tr>
                {% endfor %}
            </tbody></table></div></div><!-- PAGINATION CONTROLS --><div class="d-flex justify-content-between align-items-center mt-3" id="paginationControls" style="display: none;"><div class="d-flex align-items-center gap-3"><div><label for="recordsPerPage" class="form-label mb-0 me-2">Records per page:</label><select id="recordsPerPage" class="form-select form-select-sm" style="width: auto; display: inline-block;"><option value="5">5</option><option value="10" selected>10</option><option value="25">25</option><option value="50">50</option></select></div><div id="recordInfo" class="text-muted small">
            Showing 1-8 of 8 records
        </div></div><nav aria-label="Team leave table pagination"><ul class="pagination pagination-sm mb-0" id="pagination"><!-- Pagination items will be generated by JavaScript --></ul></nav></div><!-- TEAM LEAVE REQUEST DETAILS MODAL --><div class="modal fade" id="teamLeaveDetailsModal" tabindex="-1" aria-labelledby="teamLeaveDetailsModalLabel" aria-hidden="true"><br><br><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content" style="border:none; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.15);"><div class="modal-header" style="background:linear-gradient(135deg, #0a6d65 0%, #1a7370 100%); color:white; border-radius:15px 15px 0 0; border:none;"><h5 class="modal-title fw-bold" id="teamLeaveDetailsModalLabel"><i class="fas fa-calendar-alt me-2"></i>Team Leave Request Details
                </h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body p-4"><div id="teamLeaveModalContent"><!-- Content will be populated by JavaScript --></div></div><div class="modal-footer border-0 pt-0"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal" 
                        style="border-radius:8px; padding:8px 20px; font-weight:500;">
                    Close
                </button><button type="button" class="btn btn-success me-2" id="approveBtn" onclick="approveTeamLeave()" style="border-radius:8px; padding:8px 20px; font-weight:500;"><i class="fas fa-check me-1"></i>Approve
                </button><button type="button" class="btn btn-danger" id="rejectBtn" onclick="rejectTeamLeave()" style="border-radius:8px; padding:8px 20px; font-weight:500;"><i class="fas fa-times me-1"></i>Reject
                </button></div></div></div></div><!-- REJECTION REASON MODAL --><div class="modal fade" id="rejectionReasonModal" tabindex="-1" aria-labelledby="rejectionReasonModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content" style="border:none; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.15);"><div class="modal-header" style="background:linear-gradient(135deg, #dc3545 0%, #c82333 100%); color:white; border-radius:15px 15px 0 0; border:none;"><h5 class="modal-title fw-bold" id="rejectionReasonModalLabel"><i class="fas fa-times-circle me-2"></i>Rejection Reason
                </h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body p-4"><form id="rejectionForm"><div class="mb-3"><label for="rejectionReason" class="form-label fw-bold">Please provide a reason for rejection:</label><textarea class="form-control" id="rejectionReason" rows="4" 
                                  placeholder="Enter rejection reason..."
                                  style="border:1px solid #ddd; border-radius:8px; padding:10px; resize:vertical;" required></textarea></div></form></div><div class="modal-footer border-0 pt-0"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal" 
                        style="border-radius:8px; padding:8px 20px; font-weight:500;">
                    Cancel
                </button><button type="button" class="btn btn-danger" onclick="confirmTeamRejection()" style="border-radius:8px; padding:8px 20px; font-weight:500;"><i class="fas fa-times me-1"></i>Reject Leave
                </button></div></div></div></div></main><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script><!-- Profile Dropdown Functions --><script>
// Sample team leave data
const teamLeaveRequests = [
    { 
        id: 'LV001', 
        name: 'Alice Johnson', 
        role: 'Senior Developer', 
        leaveType: 'Sick Leave', 
        startDate: '2024-01-22', 
        endDate: '2024-01-22', 
        days: 1, 
        reason: 'Medical appointment', 
        appliedOn: '2024-01-20', 
        status: 'Pending' 
    },
    { 
        id: 'LV002', 
        name: 'Bob Smith', 
        role: 'Frontend Developer', 
        leaveType: 'Personal Leave', 
        startDate: '2024-01-25', 
        endDate: '2024-01-26', 
        days: 2, 
        reason: 'Family event', 
        appliedOn: '2024-01-19', 
        status: 'Pending' 
    },
    { 
        id: 'LV003', 
        name: 'Carol Davis', 
        role: 'Backend Developer', 
        leaveType: 'Annual Leave', 
        startDate: '2024-01-30', 
        endDate: '2024-02-02', 
        days: 4, 
        reason: 'Vacation', 
        appliedOn: '2024-01-17', 
        status: 'Pending' 
    },
    { 
        id: 'LV004', 
        name: 'David Wilson', 
        role: 'DevOps Engineer', 
        leaveType: 'Emergency Leave', 
        startDate: '2024-01-21', 
        endDate: '2024-01-21', 
        days: 1, 
        reason: 'Family emergency', 
        appliedOn: '2024-01-20', 
        status: 'Approved' 
    },
    { 
        id: 'LV005', 
        name: 'Emma Brown', 
        role: 'UI/UX Designer', 
        leaveType: 'Personal Leave', 
        startDate: '2024-01-28', 
        endDate: '2024-01-28', 
        days: 1, 
        reason: 'Doctor visit', 
        appliedOn: '2024-01-18', 
        status: 'Pending' 
    },
    { 
        id: 'LV006', 
        name: 'Frank Miller', 
        role: 'QA Engineer', 
        leaveType: 'Sick Leave', 
        startDate: '2024-01-15', 
        endDate: '2024-01-16', 
        days: 2, 
        reason: 'Flu symptoms', 
        appliedOn: '2024-01-14', 
        status: 'Approved' 
    },
    { 
        id: 'LV007', 
        name: 'Grace Lee', 
        role: 'Full Stack Developer', 
        leaveType: 'Annual Leave', 
        startDate: '2024-02-05', 
        endDate: '2024-02-09', 
        days: 5, 
        reason: 'Planned vacation', 
        appliedOn: '2024-01-15', 
        status: 'Pending' 
    },
    { 
        id: 'LV008', 
        name: 'Henry Taylor', 
        role: 'Database Admin', 
        leaveType: 'Personal Leave', 
        startDate: '2024-01-18', 
        endDate: '2024-01-19', 
        days: 2, 
        reason: 'Personal matters', 
        appliedOn: '2024-01-16', 
        status: 'Rejected' 
    }
];

// Populate team leave table
function populateTeamLeaveTable() {
    const tableBody = document.getElementById('teamLeaveTableBody');
    tableBody.innerHTML = '';

    teamLeaveRequests.forEach(request => {
        const row = document.createElement('tr');
        
        const statusClass = {
            'Pending': 'text-warning',
            'Approved': 'text-success',
            'Rejected': 'text-danger'
        }[request.status] || 'text-secondary';

        row.innerHTML = `
            <td class="px-4 py-3">${request.name}</td><td class="px-4 py-3">${request.role}</td><td class="px-4 py-3">${request.leaveType}</td><td class="px-4 py-3">${request.startDate}</td><td class="px-4 py-3">${request.endDate}</td><td class="px-4 py-3">${request.days}</td><td class="px-4 py-3">${request.reason}</td><td class="px-4 py-3">${request.appliedOn}</td><td class="px-4 py-3"><span class="${statusClass}">${request.status}</span></td><td class="px-4 py-3"><button class="btn btn-sm btn-outline-primary me-1" onclick="viewTeamLeaveDetails('${request.id}')"><i class="fas fa-eye"></i></button>
                ${request.status === 'Pending' ? `
                    <button class="btn btn-sm btn-success me-1" onclick="quickApprove('${request.id}')"><i class="fas fa-check"></i></button><button class="btn btn-sm btn-danger" onclick="quickReject('${request.id}')"><i class="fas fa-times"></i></button>
                ` : ''}
            </td>
        `;
        
        tableBody.appendChild(row);
    });
}

// View team leave details
function viewTeamLeaveDetails(requestId) {
    const request = teamLeaveRequests.find(r => r.id === requestId);
    if (request) {
        const modalContent = document.getElementById('teamLeaveModalContent');
        modalContent.innerHTML = `
            <div class="row"><div class="col-md-6"><h6 class="fw-bold">Team Member Information</h6><p><strong>Name:</strong> ${request.name}</p><p><strong>Role:</strong> ${request.role}</p><p><strong>Request ID:</strong> ${request.id}</p><p><strong>Applied On:</strong> ${request.appliedOn}</p></div><div class="col-md-6"><h6 class="fw-bold">Leave Details</h6><p><strong>Leave Type:</strong> ${request.leaveType}</p><p><strong>Start Date:</strong> ${request.startDate}</p><p><strong>End Date:</strong> ${request.endDate}</p><p><strong>Total Days:</strong> ${request.days}</p></div></div><div class="row mt-3"><div class="col-12"><h6 class="fw-bold">Reason for Leave</h6><p>${request.reason}</p></div></div><div class="row mt-3"><div class="col-12"><h6 class="fw-bold">Status</h6><p><span class="text-${request.status.toLowerCase()}">${request.status}</span></p></div></div>
        `;
        
        // Show/hide approve/reject buttons based on status
        const approveBtn = document.getElementById('approveBtn');
        const rejectBtn = document.getElementById('rejectBtn');
        
        if (request.status === 'Pending') {
            approveBtn.style.display = 'inline-block';
            rejectBtn.style.display = 'inline-block';
        } else {
            approveBtn.style.display = 'none';
            rejectBtn.style.display = 'none';
        }
        
        const modal = new bootstrap.Modal(document.getElementById('teamLeaveDetailsModal'));
        modal.show();
    }
}

// Quick approve
function quickApprove(requestId) {
    if (confirm('Are you sure you want to approve this leave request?')) {
        const request = teamLeaveRequests.find(r => r.id === requestId);
        if (request) {
            request.status = 'Approved';
            populateTeamLeaveTable();
            alert('Leave request approved successfully!');
        }
    }
}

// Quick reject
function quickReject(requestId) {
    const request = teamLeaveRequests.find(r => r.id === requestId);
    if (request) {
        document.getElementById('rejectionReason').value = '';
        const modal = new bootstrap.Modal(document.getElementById('rejectionReasonModal'));
        modal.show();
        
        // Store the request ID for later use
        document.getElementById('rejectionForm').dataset.requestId = requestId;
    }
}

// Confirm team rejection
function confirmTeamRejection() {
    const reason = document.getElementById('rejectionReason').value.trim();
    const form = document.getElementById('rejectionForm');
    const requestId = form.dataset.requestId;
    
    if (!reason) {
        alert('Please provide a reason for rejection.');
        return;
    }
    
    const request = teamLeaveRequests.find(r => r.id === requestId);
    if (request) {
        request.status = 'Rejected';
        request.rejectionReason = reason;
        populateTeamLeaveTable();
        
        const modal = bootstrap.Modal.getInstance(document.getElementById('rejectionReasonModal'));
        modal.hide();
        
        alert('Leave request rejected successfully!');
    }
}

// Approve team leave
function approveTeamLeave() {
    // This would be called from the modal approve button
    alert('Leave request approved successfully!');
    
    const modal = bootstrap.Modal.getInstance(document.getElementById('teamLeaveDetailsModal'));
    modal.hide();
}

// Reject team leave
function rejectTeamLeave() {
    // This would show the rejection reason modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('teamLeaveDetailsModal'));
    modal.hide();
    
    setTimeout(() => {
        const rejectionModal = new bootstrap.Modal(document.getElementById('rejectionReasonModal'));
        rejectionModal.show();
    }, 100);
}

// Export team leave data
function exportTeamLeaveData() {
    alert('Exporting team leave data...');
    // In real implementation, this would generate and download a report
}

// Initialize table when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    populateTeamLeaveTable();
});
</script>

{% endblock %}


