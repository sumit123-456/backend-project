{% load static %} {% block content %}

<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>HR Profiles Management</title><link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"><style>
        :root {
            --teal-primary: #003838;
            --teal-dark: #045757;
            --teal-light: #056b6b;
            --teal-bg: #045858;
        }

        body {
            background: linear-gradient(135deg, var(--teal-bg) 0%, #ffffff 100%);
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        .top-bar {
            background: linear-gradient(135deg, var(--teal-primary) 0%, var(--teal-dark) 100%);
            color: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .stats-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid var(--teal-primary);
            transition: all 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .stats-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            background: var(--teal-primary);
            margin-right: 15px;
        }

        .table-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .profile-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--teal-light);
        }

        .btn-action {
            padding: 8px 12px;
            margin: 0 2px;
            border-radius: 6px;
            font-size: 12px;
        }

        .access-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .access-admin {
            background: #dc3545;
            color: white;
        }

        .access-hr {
            background: var(--teal-primary);
            color: white;
        }

        .employment-fulltime {
            background: #28a745;
            color: white;
        }

        .employment-parttime {
            background: #ffc107;
            color: black;
        }

        .employment-contract {
            background: #17a2b8;
            color: white;
        }

        .search-box {
            border: 2px solid var(--teal-bg);
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 14px;
        }

        .search-box:focus {
            border-color: var(--teal-primary);
            box-shadow: 0 0 0 0.2rem rgba(0, 128, 128, 0.15);
        }
    </style></head><body><div class="top-bar"><div class="container-fluid"><div class="row align-items-center"><div class="col-md-6"><h1 class="mb-0"><i class="fas fa-users-cog"></i> HR Profiles Management
                    </h1></div><div class="col-md-6 text-end"><a href="{% url 'create-hr-profile' %}" class="btn btn-light btn-lg"><i class="fas fa-plus"></i> Create New HR Profile
                    </a></div></div></div></div><div class="container-fluid mt-4"><!-- Statistics Cards --><div class="row mb-4"><div class="col-md-3 mb-3"><div class="stats-card d-flex align-items-center"><div class="stats-icon"><i class="fas fa-users"></i></div><div><h3 class="mb-0">{{ total_profiles }}</h3><p class="mb-0 text-muted">Total HR Profiles</p></div></div></div><div class="col-md-3 mb-3"><div class="stats-card d-flex align-items-center"><div class="stats-icon" style="background: #dc3545;"><i class="fas fa-user-shield"></i></div><div><h3 class="mb-0">{{ admin_count }}</h3><p class="mb-0 text-muted">Admin Level</p></div></div></div><div class="col-md-3 mb-3"><div class="stats-card d-flex align-items-center"><div class="stats-icon" style="background: #28a745;"><i class="fas fa-user-tie"></i></div><div><h3 class="mb-0">{{ hr_count }}</h3><p class="mb-0 text-muted">HR Manager</p></div></div></div><div class="col-md-3 mb-3"><div class="stats-card d-flex align-items-center"><div class="stats-icon" style="background: #ffc107;"><i class="fas fa-briefcase"></i></div><div><h3 class="mb-0">{{ fulltime_count }}</h3><p class="mb-0 text-muted">Full-Time</p></div></div></div></div><!-- Messages -->
        {% if messages %}
        <div class="row mb-4"><div class="col-12">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>
                {% endfor %}
            </div></div>
        {% endif %}

        <!-- Search and Export --><div class="row mb-3"><div class="col-md-6"><div class="input-group"><span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span><input type="text" class="form-control border-start-0 search-box" id="searchInput" placeholder="Search HR profiles..."></div></div><div class="col-md-6 text-end"><a href="{% url 'export-hr-profiles' %}" class="btn btn-outline-primary"><i class="fas fa-download"></i> Export to Excel
                </a></div></div><!-- HR Profiles Table --><div class="table-container"><div class="table-responsive"><table class="table table-hover" id="hrProfilesTable"><thead class="table-dark"><tr><th>Profile</th><th>Employee ID</th><th>Contact Info</th><th>Designation</th><th>Department</th><th>Access Level</th><th>Employment Type</th><th>Join Date</th><th>Actions</th></tr></thead><tbody>
                        {% for hr in hr_profiles %}
                        <tr><td><div class="d-flex align-items-center">
                                    {% if hr.profile_image %}
                                        <img src="{{ hr.profile_image.url }}" alt="Profile" class="profile-img me-3">
                                    {% else %}
                                        <div class="profile-img bg-light d-flex align-items-center justify-content-center me-3"><i class="fas fa-user text-muted"></i></div>
                                    {% endif %}
                                    <div><strong>{{ hr.full_name }}</strong><br><small class="text-muted">{{ hr.username }}</small></div></div></td><td><code class="bg-light px-2 py-1 rounded">{{ hr.employee_id }}</code></td><td><div><i class="fas fa-envelope text-muted"></i> {{ hr.email|truncatechars:20 }}
                                    <br><i class="fas fa-phone text-muted"></i> {{ hr.mobile }}
                                </div></td><td>{{ hr.designation }}</td><td>{{ hr.department }}</td><td><span class="access-badge {% if hr.access_level == 'Admin' %}access-admin{% else %}access-hr{% endif %}">
                                    {{ hr.access_level }}
                                </span></td><td><span class="employment-badge badge {% if hr.employment_type == 'Full-Time' %}employment-fulltime{% elif hr.employment_type == 'Part-Time' %}employment-parttime{% else %}employment-contract{% endif %}">
                                    {{ hr.employment_type }}
                                </span></td><td>{{ hr.date_of_joining|date:"d M Y" }}</td><td><div class="btn-group" role="group"><button class="btn btn-info btn-action" onclick="viewProfile({{ hr.id }})" title="View Details"><i class="fas fa-eye"></i></button><button class="btn btn-danger btn-action" onclick="deleteProfile({{ hr.id }}, '{{ hr.full_name }}')" title="Delete"><i class="fas fa-trash"></i></button></div></td></tr>
                        {% empty %}
                        <tr><td colspan="9" class="text-center py-5"><div class="text-muted"><i class="fas fa-users fa-3x mb-3"></i><h5>No HR Profiles Found</h5><p>Create your first HR profile to get started.</p><a href="{% url 'create-hr-profile' %}" class="btn btn-primary"><i class="fas fa-plus"></i> Create HR Profile
                                    </a></div></td></tr>
                        {% endfor %}
                    </tbody></table></div></div></div><!-- Profile Details Modal --><div class="modal fade" id="profileModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">HR Profile Details</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body" id="profileDetails"><!-- Profile details will be loaded here --></div></div></div></div><!-- Delete Confirmation Modal --><div class="modal fade" id="deleteModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Confirm Delete</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>Are you sure you want to delete this HR profile?</p><p id="deleteProfileName" class="fw-bold text-danger"></p></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button type="button" class="btn btn-danger" id="confirmDelete">Delete</button></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script><script>
        // Search functionality
        document.getElementById('searchInput').addEventListener('keyup', function() {
            const searchValue = this.value.toLowerCase();
            const table = document.getElementById('hrProfilesTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchValue) ? '' : 'none';
            }
        });

        // View Profile Details
        function viewProfile(profileId) {
            fetch(`/get-hr-profile/${profileId}/`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const profile = data.profile;
                        const detailsHtml = `
                            <div class="row"><div class="col-md-4 text-center mb-3">
                                    ${profile.profile_image ? 
                                        `<img src="${profile.profile_image}" class="img-fluid rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">` :
                                        '<div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 150px; height: 150px;"><i class="fas fa-user fa-3x text-muted"></i></div>'
                                    }
                                </div><div class="col-md-8"><h4>${profile.full_name}</h4><p class="text-muted mb-1">Employee ID: ${profile.employee_id}</p><p class="text-muted mb-1">Designation: ${profile.designation}</p><p class="text-muted mb-1">Department: ${profile.department}</p><p class="text-muted mb-1">Access Level: <span class="badge ${profile.access_level === 'Admin' ? 'bg-danger' : 'bg-primary'}">${profile.access_level}</span></p><p class="text-muted mb-1">Employment Type: <span class="badge bg-success">${profile.employment_type}</span></p><p class="text-muted">Join Date: ${profile.date_of_joining}</p></div></div><hr><div class="row"><div class="col-md-6"><h6>Contact Information</h6><p><i class="fas fa-envelope"></i> ${profile.email}</p><p><i class="fas fa-phone"></i> ${profile.mobile}</p></div></div>
                        `;
                        document.getElementById('profileDetails').innerHTML = detailsHtml;
                        new bootstrap.Modal(document.getElementById('profileModal')).show();
                    } else {
                        alert('Error loading profile details');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error loading profile details');
                });
        }

        // Delete Profile
        let profileToDelete = null;

        function deleteProfile(profileId, profileName) {
            profileToDelete = profileId;
            document.getElementById('deleteProfileName').textContent = profileName;
            new bootstrap.Modal(document.getElementById('deleteModal')).show();
        }

        document.getElementById('confirmDelete').addEventListener('click', function() {
            if (profileToDelete) {
                fetch(`/delete-hr-profile/${profileToDelete}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Error deleting profile');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error deleting profile');
                });
            }
        });

        // Helper function to get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script></body></html>

{% endblock %}